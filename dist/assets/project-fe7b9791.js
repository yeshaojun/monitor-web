import{d as Z,r as D,a as L,c as E,b as V,e as a,w as t,f as w,u as f,g as u,F as C,E as ee,o as s,h as r,i as M,j as N,k as te,l as U,t as ae}from"./index-937afe1d.js";import{v as j,L as S,u as v,E as le}from"./http-bb505255.js";import{E as oe,a as se,b as ne,c as re,d as ie,e as de,f as ue}from"./el-table-column-47968ffb.js";import{E as ce,a as me}from"./el-form-item-7241c3ae.js";const _e={install(b){b.directive("loading",j),b.config.globalProperties.$loading=S},directive:j,service:S},pe={class:"mb-5"},fe={class:"dialog-footer"},ve={class:"dialog-footer"},Ee=Z({__name:"project",setup(b){const T=te(),c=D(!1),m=D(!1),i=L({name:"",desc:""}),_=L({users:[],id:""}),{isFetching:z,data:I,execute:y}=v("project/list").get(),{data:x}=v("user/list").get().json(),{isFetching:F,data:O,execute:P}=v("project/create",{immediate:!1}).post(i),q=async d=>{const l=_e.service({fullscreen:!0,text:"数据删除中"}),{data:o}=await v(`project/${d}`).delete();o&&(l.close(),y())};function J(){c.value=!0,i.name="",i.desc=""}async function K(){await P(),O&&(U.success("创建成功！"),c.value=!1,y())}function R(d){T.push({path:"/error",query:{id:d}})}async function A(){const{error:d}=await v("project/member").put(_).json();d.value||(U.success("添加成功！"),m.value=!1,y())}function G(d,l){m.value=!0,_.id=d;let o=[];x.value.forEach(n=>{l.find(g=>g._id===n._id)&&o.push(n._id)}),_.users=o}return(d,l)=>{const o=ee,n=ne,g=de,H=re,Q=oe,$=le,h=ce,W=me,B=se,X=ue,Y=ie,k=j;return s(),E(C,null,[V("div",pe,[a(o,{type:"primary",onClick:J},{default:t(()=>[r("新增")]),_:1})]),w((s(),u(Q,{stripe:"",data:JSON.parse(f(I)),style:{width:"100%"}},{default:t(()=>[a(n,{prop:"_id",label:"apiKey"}),a(n,{prop:"name",label:"项目名称"}),a(n,{prop:"desc",label:"描述"}),a(n,{label:"项目成员"},{default:t(e=>[(s(!0),E(C,null,M(e.row.member,p=>(s(),u(g,{key:p._id,class:"ml-2",type:"success"},{default:t(()=>[r(ae(p.nickname),1)]),_:2},1024))),128))]),_:1}),a(n,{prop:"created_at",label:"创建时间"}),a(n,{label:"操作"},{default:t(e=>[a(H,null,{default:t(()=>[a(o,{type:"primary",size:"small",onClick:p=>R(e.row._id)},{default:t(()=>[r("查看日志")]),_:2},1032,["onClick"]),e.row.isCreated?(s(),u(o,{key:0,type:"primary",size:"small",onClick:p=>G(e.row._id,e.row.member)},{default:t(()=>[r("添加项目成员")]),_:2},1032,["onClick"])):N("",!0),e.row.isCreated?(s(),u(o,{key:1,link:"",type:"primary",size:"small",onClick:p=>q(e.row._id)},{default:t(()=>[r("移除")]),_:2},1032,["onClick"])):N("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[k,f(z)]]),a(B,{modelValue:c.value,"onUpdate:modelValue":l[3]||(l[3]=e=>c.value=e),title:"新增项目",width:"30%"},{footer:t(()=>[V("span",fe,[a(o,{onClick:l[2]||(l[2]=e=>c.value=!1)},{default:t(()=>[r("取消")]),_:1}),w((s(),u(o,{type:"primary",onClick:K},{default:t(()=>[r(" 创建 ")]),_:1})),[[k,f(F)]])])]),default:t(()=>[a(W,{form:i},{default:t(()=>[a(h,{label:"项目名称"},{default:t(()=>[a($,{modelValue:i.name,"onUpdate:modelValue":l[0]||(l[0]=e=>i.name=e)},null,8,["modelValue"])]),_:1}),a(h,{label:"项目描述"},{default:t(()=>[a($,{modelValue:i.desc,"onUpdate:modelValue":l[1]||(l[1]=e=>i.desc=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["form"])]),_:1},8,["modelValue"]),a(B,{modelValue:m.value,"onUpdate:modelValue":l[6]||(l[6]=e=>m.value=e),title:"添加项目成员",width:"30%"},{footer:t(()=>[V("span",ve,[a(o,{onClick:l[5]||(l[5]=e=>m.value=!1)},{default:t(()=>[r("取消")]),_:1}),w((s(),u(o,{type:"primary",onClick:A},{default:t(()=>[r(" 创建 ")]),_:1})),[[k,f(F)]])])]),default:t(()=>[a(Y,{modelValue:_.users,"onUpdate:modelValue":l[4]||(l[4]=e=>_.users=e),multiple:"",style:{width:"100%"}},{default:t(()=>[(s(!0),E(C,null,M(f(x),e=>(s(),u(X,{key:e._id,value:e._id,label:e.nickname},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])],64)}}});export{Ee as default};
