import{d as te,r as D,a as F,c as w,b as C,e as a,w as t,f as x,u,g as c,F as $,h as le,E as ae,i as oe,o as n,j as s,k as L,l as j,m as S,t as ne}from"./index-24323a28.js";import{v as U,L as z,u as p,E as se}from"./request-cd826f62.js";import{E as re,a as ie,b as de,c as ue,d as ce,e as me}from"./el-table-column-6651b3b7.js";import{E as _e,a as pe}from"./el-form-item-fe2ee034.js";const fe={install(y){y.directive("loading",U),y.config.globalProperties.$loading=z},directive:U,service:z},ve={class:"mb-5"},ye={class:"dialog-footer"},be={class:"dialog-footer"},we=te({__name:"project",setup(y){const b=JSON.parse(localStorage.getItem("userInfo")),M=le(),_=D(!1),f=D(!1),i=F({name:"",desc:""}),v=F({users:[],id:""}),{loading:T,data:P,execute:g}=p("project/list"),{data:k}=p("user/list"),{loading:N,data:q,execute:O}=p("project/create",{method:"post",data:i},{immediate:!1}),R=async d=>{const l=fe.service({fullscreen:!0,text:"数据删除中"}),{data:o}=await p(`project/${d}`,{method:"delete"});o&&(l.close(),g())};function A(){_.value=!0,i.name="",i.desc=""}async function J(){await O(),q&&(S.success("创建成功！"),_.value=!1,g())}function K(d){M.push({path:"/error",query:{id:d}})}async function G(){}function H(d,l){f.value=!0,v.id=d;let o=[];k.value&&k.value.forEach(r=>{l.find(E=>E._id===r._id)&&o.push(r._id)}),v.users=o}async function Q(d){const{error:l}=await p(`project/exit?id=${d}`,{method:"put"});console.log(l.value),l.value||(S.success("操作成功！"),g())}return(d,l)=>{const o=ae,r=ie,E=ce,W=de,X=re,I=se,h=_e,Y=pe,B=oe,Z=me,ee=ue,V=U;return n(),w($,null,[C("div",ve,[a(o,{type:"primary",onClick:A},{default:t(()=>[s("新增")]),_:1})]),x((n(),c(X,{stripe:"",data:u(P),style:{width:"100%"}},{default:t(()=>[a(r,{prop:"_id",label:"apiKey"}),a(r,{prop:"name",label:"项目名称"}),a(r,{prop:"desc",label:"描述"}),a(r,{label:"项目成员"},{default:t(e=>[(n(!0),w($,null,L(e.row.member,m=>(n(),c(E,{key:m._id,class:"ml-2",type:"success"},{default:t(()=>[s(ne(m.nickName),1)]),_:2},1024))),128))]),_:1}),a(r,{prop:"createdAt",label:"创建时间"}),a(r,{label:"操作"},{default:t(e=>[a(W,null,{default:t(()=>[a(o,{type:"primary",size:"small",onClick:m=>K(e.row._id)},{default:t(()=>[s("查看日志")]),_:2},1032,["onClick"]),u(b).id!==e.row.createUser?(n(),c(o,{key:0,type:"primary",size:"small",onClick:m=>Q(e.row._id)},{default:t(()=>[s("退出项目")]),_:2},1032,["onClick"])):j("",!0),u(b).id===e.row.createUser?(n(),c(o,{key:1,type:"primary",size:"small",onClick:m=>H(e.row._id,e.row.member)},{default:t(()=>[s("添加成员")]),_:2},1032,["onClick"])):j("",!0),u(b).id===e.row.createUser?(n(),c(o,{key:2,link:"",type:"primary",size:"small",onClick:m=>R(e.row._id)},{default:t(()=>[s("移除项目")]),_:2},1032,["onClick"])):j("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[V,u(T)]]),a(B,{modelValue:_.value,"onUpdate:modelValue":l[3]||(l[3]=e=>_.value=e),title:"新增项目",width:"30%"},{footer:t(()=>[C("span",ye,[a(o,{onClick:l[2]||(l[2]=e=>_.value=!1)},{default:t(()=>[s("取消")]),_:1}),x((n(),c(o,{type:"primary",onClick:J},{default:t(()=>[s(" 创建 ")]),_:1})),[[V,u(N)]])])]),default:t(()=>[a(Y,{form:i},{default:t(()=>[a(h,{label:"项目名称"},{default:t(()=>[a(I,{modelValue:i.name,"onUpdate:modelValue":l[0]||(l[0]=e=>i.name=e)},null,8,["modelValue"])]),_:1}),a(h,{label:"项目描述"},{default:t(()=>[a(I,{modelValue:i.desc,"onUpdate:modelValue":l[1]||(l[1]=e=>i.desc=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["form"])]),_:1},8,["modelValue"]),a(B,{modelValue:f.value,"onUpdate:modelValue":l[6]||(l[6]=e=>f.value=e),title:"添加项目成员",width:"30%"},{footer:t(()=>[C("span",be,[a(o,{onClick:l[5]||(l[5]=e=>f.value=!1)},{default:t(()=>[s("取消")]),_:1}),x((n(),c(o,{type:"primary",onClick:G},{default:t(()=>[s(" 创建 ")]),_:1})),[[V,u(N)]])])]),default:t(()=>[a(ee,{modelValue:v.users,"onUpdate:modelValue":l[4]||(l[4]=e=>v.users=e),multiple:"",style:{width:"100%"}},{default:t(()=>[(n(!0),w($,null,L(u(k),e=>(n(),c(Z,{key:e._id,value:e._id,label:e.nickName},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])],64)}}});export{we as default};
