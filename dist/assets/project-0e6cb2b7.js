import{d as ee,r as M,a as N,u as m,c as E,b as w,e as l,w as t,f as C,g as v,h as d,F as V,E as te,i as ae,o as n,j as r,k as U,l as j,m as le,n as x,t as oe}from"./index-a123defa.js";import{v as $,L as z,E as ne}from"./el-input-a8a9beae.js";import{E as se,a as re,b as ie,c as ue,d as de,e as ce}from"./el-table-column-45a6c41b.js";import{E as me,a as _e}from"./el-form-item-164ed6a9.js";const pe={install(b){b.directive("loading",$),b.config.globalProperties.$loading=z},directive:$,service:z},fe={class:"mb-5"},ve={class:"dialog-footer"},ye={class:"dialog-footer"},we=ee({__name:"project",setup(b){const S=le(),_=M(!1),p=M(!1),u=N({name:"",desc:""}),f=N({users:[],id:""}),{isFetching:T,data:I,execute:y}=m("project/list").get(),{data:F}=m("user/list").get().json(),{isFetching:h,data:P,execute:O}=m("project/create",{immediate:!1}).post(u),q=async s=>{const a=pe.service({fullscreen:!0,text:"数据删除中"}),{data:o}=await m(`project/${s}`).delete();o&&(a.close(),y())};function J(){_.value=!0,u.name="",u.desc=""}async function K(){await O(),P&&(x.success("创建成功！"),_.value=!1,y())}function R(s){S.push({path:"/error",query:{id:s}})}async function A(){const{error:s}=await m("project/member").put(f).json();s.value||(x.success("添加成功！"),p.value=!1,y())}function G(s,a){p.value=!0,f.id=s;let o=[];F.value.forEach(i=>{a.find(g=>g._id===i._id)&&o.push(i._id)}),f.users=o}async function H(s){const{error:a}=await m(`project/exit?id=${s}`).put();console.log(a.value),a.value||(x.success("操作成功！"),y())}return(s,a)=>{const o=te,i=re,g=de,Q=ie,W=se,B=ne,D=me,X=_e,L=ae,Y=ce,Z=ue,k=$;return n(),E(V,null,[w("div",fe,[l(o,{type:"primary",onClick:J},{default:t(()=>[r("新增")]),_:1})]),C((n(),d(W,{stripe:"",data:JSON.parse(v(I)),style:{width:"100%"}},{default:t(()=>[l(i,{prop:"_id",label:"apiKey"}),l(i,{prop:"name",label:"项目名称"}),l(i,{prop:"desc",label:"描述"}),l(i,{label:"项目成员"},{default:t(e=>[(n(!0),E(V,null,U(e.row.member,c=>(n(),d(g,{key:c._id,class:"ml-2",type:"success"},{default:t(()=>[r(oe(c.nickname),1)]),_:2},1024))),128))]),_:1}),l(i,{prop:"created_at",label:"创建时间"}),l(i,{label:"操作"},{default:t(e=>[l(Q,null,{default:t(()=>[l(o,{type:"primary",size:"small",onClick:c=>R(e.row._id)},{default:t(()=>[r("查看日志")]),_:2},1032,["onClick"]),e.row.isCreated?j("",!0):(n(),d(o,{key:0,type:"primary",size:"small",onClick:c=>H(e.row._id)},{default:t(()=>[r("退出项目")]),_:2},1032,["onClick"])),e.row.isCreated?(n(),d(o,{key:1,type:"primary",size:"small",onClick:c=>G(e.row._id,e.row.member)},{default:t(()=>[r("添加项目成员")]),_:2},1032,["onClick"])):j("",!0),e.row.isCreated?(n(),d(o,{key:2,link:"",type:"primary",size:"small",onClick:c=>q(e.row._id)},{default:t(()=>[r("移除项目")]),_:2},1032,["onClick"])):j("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[k,v(T)]]),l(L,{modelValue:_.value,"onUpdate:modelValue":a[3]||(a[3]=e=>_.value=e),title:"新增项目",width:"30%"},{footer:t(()=>[w("span",ve,[l(o,{onClick:a[2]||(a[2]=e=>_.value=!1)},{default:t(()=>[r("取消")]),_:1}),C((n(),d(o,{type:"primary",onClick:K},{default:t(()=>[r(" 创建 ")]),_:1})),[[k,v(h)]])])]),default:t(()=>[l(X,{form:u},{default:t(()=>[l(D,{label:"项目名称"},{default:t(()=>[l(B,{modelValue:u.name,"onUpdate:modelValue":a[0]||(a[0]=e=>u.name=e)},null,8,["modelValue"])]),_:1}),l(D,{label:"项目描述"},{default:t(()=>[l(B,{modelValue:u.desc,"onUpdate:modelValue":a[1]||(a[1]=e=>u.desc=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["form"])]),_:1},8,["modelValue"]),l(L,{modelValue:p.value,"onUpdate:modelValue":a[6]||(a[6]=e=>p.value=e),title:"添加项目成员",width:"30%"},{footer:t(()=>[w("span",ye,[l(o,{onClick:a[5]||(a[5]=e=>p.value=!1)},{default:t(()=>[r("取消")]),_:1}),C((n(),d(o,{type:"primary",onClick:A},{default:t(()=>[r(" 创建 ")]),_:1})),[[k,v(h)]])])]),default:t(()=>[l(Z,{modelValue:f.users,"onUpdate:modelValue":a[4]||(a[4]=e=>f.users=e),multiple:"",style:{width:"100%"}},{default:t(()=>[(n(!0),E(V,null,U(v(F),e=>(n(),d(Y,{key:e._id,value:e._id,label:e.nickname},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])],64)}}});export{we as default};
